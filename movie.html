<!DOCTYPE html>
<html>
<head>
  <meta name="databricks-html-version" content="1">
<title>movie-test - Databricks</title>

<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta name="robots" content="nofollow">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700">

<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/lib/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/lib/jquery-ui-bundle/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/css/main.css">
<link rel="stylesheet" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/css/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/img/favicon.ico"/>
<script>window.settings = {"enableSshKeyUI":false,"defaultInteractivePricePerDBU":0.4,"enableOnDemandClusterType":true,"enableAutoCompleteAsYouType":[],"devTierName":"Community Edition","enableJobsPrefetching":true,"workspaceFeaturedLinks":[{"linkURI":"https://docs.databricks.com/index.html","displayName":"Documentation","icon":"question"},{"linkURI":"https://docs.databricks.com/release-notes/product/index.html","displayName":"Release Notes","icon":"code"},{"linkURI":"https://docs.databricks.com/spark/latest/training/index.html","displayName":"Training & Tutorials","icon":"graduation-cap"}],"enableClearStateFeature":false,"dbcForumURL":"http://forums.databricks.com/","enableProtoClusterInfoDeltaPublisher":true,"maxCustomTags":45,"enableInstanceProfilesUIInJobs":true,"nodeInfo":{"node_types":[{"support_ssh":false,"spark_heap_memory":4800,"instance_type_id":"r3.2xlarge","spark_core_oversubscription_factor":8.0,"node_type_id":"dev-tier-node","description":"Community Optimized","support_cluster_tags":false,"container_memory_mb":6000,"node_instance_type":{"instance_type_id":"r3.2xlarge","provider":"AWS","compute_units":26.0,"number_of_ips":15,"local_disks":1,"reserved_compute_units":3.64,"memory_mb":62464,"num_cores":8,"reserved_memory_mb":4800},"memory_mb":6144,"is_hidden":false,"category":"Community Edition","num_cores":0.88,"support_ebs_volumes":false,"is_deprecated":false}],"default_node_type_id":"dev-tier-node"},"enableClusterAcls":true,"notebookRevisionVisibilityHorizon":999999,"enableTableHandler":true,"maxEbsVolumesPerInstance":10,"isAdmin":true,"deltaProcessingBatchSize":1000,"enableLargeResultDownload":true,"maxElasticDiskCapacityGB":5000,"zoneInfos":[{"id":"us-west-2c","isDefault":true},{"id":"us-west-2b","isDefault":false},{"id":"us-west-2a","isDefault":false}],"enableCustomSpotPricingUIByTier":false,"enableEBSVolumesUIForJobs":true,"enablePublishNotebooks":true,"enableMaxConcurrentRuns":true,"enableJobAclsConfig":false,"enableFullTextSearch":false,"enableElasticSparkUI":false,"enableNewClustersCreate":true,"clusters":true,"allowRunOnPendingClusters":true,"fileStoreBase":"FileStore","enableSshKeyUIInJobs":true,"enableDetachAndAttachSubMenu":false,"configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."}],"enableReactNotebookComments":true,"enableAdminPasswordReset":false,"enableResetPassword":true,"maxClusterTagValueLength":255,"enableJobsSparkUpgrade":true,"perClusterAutoterminationEnabled":false,"enableNotebookCommandNumbers":true,"sparkVersions":[{"key":"1.6.3-db2-hadoop2-scala2.10","displayName":"Spark 1.6.3-db2 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-aba860a0ffce4f3471fb14aefdcb1d768ac66a53a5ad884c48745ef98aeb9d67","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.1-db5-scala2.11","displayName":"Spark 2.1.1-db5 RC2 (Scala 2.11)","packageLabel":"spark-image-3053719f98bccbb1f0410e1420ee81a22e521a0b43b6f220c318f10d281646ff","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.6.x-ubuntu15.10","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.4.x-ubuntu15.10","displayName":"Spark 1.4.1 (Hadoop 1)","packageLabel":"spark-image-f710650fb8aaade8e4e812368ea87c45cd8cd0b5e6894ca6c94f3354e8daa6dc","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.2.x-scala2.11","displayName":"Spark 2.2 RC2 (Experimental, Scala 2.11)","packageLabel":"spark-image-a89bff416842ec8c30d33a1b5aaf3683d4712ea02d0cb2d0e7fbaabfb1b9d42d","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db2-scala2.11","displayName":"Spark 2.1.0-db2 (Scala 2.11)","packageLabel":"spark-image-267c4490a3ab8a39acdbbd9f1d36f6decdecebf013e30dd677faff50f1d9cf8b","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.0.0-ubuntu15.10-scala2.10","displayName":"Spark 2.0.0 (Scala 2.10)","packageLabel":"spark-image-073c1b52ace74f251fae2680624a0d8d184a8b57096d1c21c5ce56c29be6a37a","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.2-db3-scala2.10","displayName":"Spark 2.0.2-db3 (Scala 2.10)","packageLabel":"spark-image-584091dedb690de20e8cf22d9e02fdcce1281edda99eedb441a418d50e28088f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db1-scala2.11","displayName":"Spark 2.1.0-db1 (Scala 2.11)","packageLabel":"spark-image-e8ad5b72cf0f899dcf2b4720c1f572ab0e87a311d6113b943b4e1d4a7edb77eb","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.1.1-db4-scala2.11","displayName":"Spark 2.1.1-db4 (Scala 2.11)","packageLabel":"spark-image-52bca0ca866e3f4243d3820a783abf3b9b3b553edf234abef14b892657ceaca9","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db2-scala2.10","displayName":"Spark 2.1.0-db2 (Scala 2.10)","packageLabel":"spark-image-a2ca4f6b58c95f78dca91b1340305ab3fe32673bd894da2fa8e1dc8a9f8d0478","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.6.x-ubuntu15.10-hadoop1","displayName":"Spark 1.6.x (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.0.2-db4-scala2.11","displayName":"Spark 2.0.2-db4 (Scala 2.11)","packageLabel":"spark-image-7dbc7583e8271765b8a1508cb9e832768e35489bbde2c4c790bc6766aee2fd7f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.1-ubuntu15.10-hadoop1","displayName":"Spark 1.6.1 (Hadoop 1)","packageLabel":"spark-image-21d1cac181b7b8856dd1b4214a3a734f95b5289089349db9d9c926cb87d843db","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.x-gpu-scala2.11","displayName":"Spark 2.0 (Auto-updating, GPU, Scala 2.11 experimental)","packageLabel":"spark-image-968b89f1d0ec32e1ee4dacd04838cae25ef44370a441224177a37980d539d83a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.2-ubuntu15.10-hadoop1","displayName":"Spark 1.6.2 (Hadoop 1)","packageLabel":"spark-image-8cea23fb9094e174bf5815d79009f4a8e383eb86cf2909cf6c6434ed8da2a16a","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"1.6.3-db1-hadoop2-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 2, Scala 2.10)","packageLabel":"spark-image-eaa8d9b990015a14e032fb2e2e15be0b8d5af9627cd01d855df728b67969d5d9","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.3-db2-hadoop1-scala2.10","displayName":"Spark 1.6.3-db2 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-14112ea0645bea94333a571a150819ce85573cf5541167d905b7e6588645cf3b","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.2-ubuntu15.10-hadoop2","displayName":"Spark 1.6.2 (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"1.6.1-ubuntu15.10-hadoop2","displayName":"Spark 1.6.1 (Hadoop 2)","packageLabel":"spark-image-4cafdf8bc6cba8edad12f441e3b3f0a8ea27da35c896bc8290e16b41fd15496a","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.2-db2-scala2.10","displayName":"Spark 2.0.2-db2 (Scala 2.10)","packageLabel":"spark-image-36d48f22cca7a907538e07df71847dd22aaf84a852c2eeea2dcefe24c681602f","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.x-ubuntu15.10-scala2.11","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.11, deprecated)","packageLabel":"spark-image-8e1c50d626a52eac5a6c8129e09ae206ba9890f4523775f77af4ad6d99a64c44","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.x-scala2.10","displayName":"Spark 2.0 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-859e88079f97f58d50e25163b39a1943d1eeac0b6939c5a65faba986477e311a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.1-db4-scala2.10","displayName":"Spark 2.1.1-db4 (Scala 2.10)","packageLabel":"spark-image-c7c0224de396cd1563addc1ae4bca6ba823780b6babe6c3729ddf73008f29ba4","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db1-scala2.11","displayName":"Spark 2.0.2-db1 (Scala 2.11)","packageLabel":"spark-image-c2d623f03dd44097493c01aa54a941fc31978ebe6d759b36c75b716b2ff6ab9c","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.2-db4-scala2.10","displayName":"Spark 2.0.2-db4 (Scala 2.10)","packageLabel":"spark-image-859e88079f97f58d50e25163b39a1943d1eeac0b6939c5a65faba986477e311a","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.1-db5-scala2.10","displayName":"Spark 2.1.1-db5 RC2 (Scala 2.10)","packageLabel":"spark-image-756e80c1f48863a7b837dca26e0a844bb2f9fe5eddf1fb6c9b69c0cf4a19cb71","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"1.5.x-ubuntu15.10","displayName":"Spark 1.5.2 (Hadoop 1)","packageLabel":"spark-image-c9d2a8abf41f157a4acc6d52bc721090346f6fea2de356f3a66e388f54481698","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.2.x-scala2.10","displayName":"Spark 2.2 RC2 (Experimental, Scala 2.10)","packageLabel":"spark-image-362326e9095981c5f1c0049a535cc25434770e7b861104e90ebddd37a302dd1f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.x-scala2.11","displayName":"Spark 2.0 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-7dbc7583e8271765b8a1508cb9e832768e35489bbde2c4c790bc6766aee2fd7f","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.x-scala2.10","displayName":"Spark 2.1 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-c7c0224de396cd1563addc1ae4bca6ba823780b6babe6c3729ddf73008f29ba4","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db3-scala2.10","displayName":"Spark 2.1.0-db3 (Scala 2.10)","packageLabel":"spark-image-25a17d070af155f10c4232dcc6248e36a2eb48c24f8d4fc00f34041b86bd1626","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db2-scala2.11","displayName":"Spark 2.0.2-db2 (Scala 2.11)","packageLabel":"spark-image-4fa852ba378e97815083b96c9cada7b962a513ec23554a5fc849f7f1dd8c065a","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"1.3.x-ubuntu15.10","displayName":"Spark 1.3.0 (Hadoop 1)","packageLabel":"spark-image-40d2842670bc3dc178b14042501847d76171437ccf70613fa397a7a24c48b912","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.1-db1-scala2.11","displayName":"Spark 2.0.1-db1 (Scala 2.11)","packageLabel":"spark-image-10ab19f634bbfdb860446c326a9f76dc25bfa87de6403b980566279142a289ea","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.2-db3-scala2.11","displayName":"Spark 2.0.2-db3 (Scala 2.11)","packageLabel":"spark-image-7fd7aaa89d55692e429115ae7eac3b1a1dc4de705d50510995f34306b39c2397","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.3-db1-hadoop1-scala2.10","displayName":"Spark 1.6.3-db1 (Hadoop 1, Scala 2.10)","packageLabel":"spark-image-d50af1032799546b8ccbeeb76889a20c819ebc2a0e68ea20920cb30d3895d3ae","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.0.2-db1-scala2.10","displayName":"Spark 2.0.2-db1 (Scala 2.10)","packageLabel":"spark-image-654bdd6e9bad70079491987d853b4b7abf3b736fff099701501acaabe0e75c41","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.x-ubuntu15.10","displayName":"Spark 2.0 (Ubuntu 15.10, Scala 2.10, deprecated)","packageLabel":"spark-image-a659f3909d51b38d297b20532fc807ecf708cfb7440ce9b090c406ab0c1e4b7e","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.0.1-db1-scala2.10","displayName":"Spark 2.0.1-db1 (Scala 2.10)","packageLabel":"spark-image-5a13c2db3091986a4e7363006cc185c5b1108c7761ef5d0218506cf2e6643840","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.1.x-scala2.11","displayName":"Spark 2.1 (Auto-updating, Scala 2.11)","packageLabel":"spark-image-52bca0ca866e3f4243d3820a783abf3b9b3b553edf234abef14b892657ceaca9","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"2.1.0-db1-scala2.10","displayName":"Spark 2.1.0-db1 (Scala 2.10)","packageLabel":"spark-image-f0ab82a5deb7908e0d159e9af066ba05fb56e1edb35bdad41b7ad2fd62a9b546","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"1.6.0-ubuntu15.10","displayName":"Spark 1.6.0 (Hadoop 1)","packageLabel":"spark-image-10ef758029b8c7e19cd7f4fb52fff9180d75db92ca071bd94c47f3c1171a7cb5","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"1.6.x-ubuntu15.10-hadoop2","displayName":"Spark 1.6.x (Hadoop 2)","packageLabel":"spark-image-161245e66d887cd775e23286a54bab0b146143e1289f25bd1732beac454a1561","upgradable":true,"deprecated":false,"customerVisible":false},{"key":"2.0.0-ubuntu15.10-scala2.11","displayName":"Spark 2.0.0 (Scala 2.11)","packageLabel":"spark-image-b4ec141e751f201399f8358a82efee202560f7ed05e1a04a2ae8778f6324b909","upgradable":true,"deprecated":true,"customerVisible":false},{"key":"2.1.0-db3-scala2.11","displayName":"Spark 2.1.0-db3 (Scala 2.11)","packageLabel":"spark-image-ccbc6b73f158e2001fc1fb8c827bfdde425d8bd6d65cb7b3269784c28bb72c16","upgradable":true,"deprecated":false,"customerVisible":true}],"enableRestrictedClusterCreation":true,"enableFeedback":true,"enableClusterAutoScaling":false,"enableUserVisibleDefaultTags":true,"defaultNumWorkers":0,"serverContinuationTimeoutMillis":10000,"driverStderrFilePrefix":"stderr","enableNotebookRefresh":false,"accountsOwnerUrl":"https://accounts.cloud.databricks.com/registration.html#login","driverStdoutFilePrefix":"stdout","defaultNodeTypeToPricingUnitsMap":{"r3.2xlarge":2,"class-node":1,"m4.2xlarge":0.5,"r4.xlarge":1,"m4.4xlarge":0.5,"r4.16xlarge":8,"p2.8xlarge":16,"m4.10xlarge":0.5,"r3.8xlarge":8,"r4.4xlarge":4,"dev-tier-node":1,"c3.8xlarge":4,"r3.4xlarge":4,"i2.4xlarge":6,"m4.xlarge":0.5,"r4.8xlarge":8,"r4.large":0.5,"development-node":1,"i2.2xlarge":3,"g2.8xlarge":6,"memory-optimized":1,"m4.large":0.5,"p2.16xlarge":24,"c3.2xlarge":1,"c4.2xlarge":1,"i2.xlarge":1.5,"compute-optimized":1,"c4.4xlarge":2,"c3.4xlarge":2,"g2.2xlarge":1.5,"p2.xlarge":2,"m4.16xlarge":0.5,"c4.8xlarge":4,"r3.xlarge":1,"r4.2xlarge":2,"i2.8xlarge":12},"enableSparkDocsSearch":true,"sparkHistoryServerEnabled":true,"enableEBSVolumesUI":false,"sanitizeMarkdownHtml":true,"enableIPythonImportExport":true,"enableClusterTagsUIForJobs":true,"enableClusterTagsUI":false,"enableNotebookHistoryDiffing":true,"branch":"2.45","accountsLimit":3,"enableSparkEnvironmentVariables":true,"enableX509Authentication":false,"enableStructuredStreamingNbOptimizations":true,"enableNotebookGitBranching":true,"local":false,"enableNotebookLazyRenderWrapper":false,"enableClusterAutoScalingForJobs":false,"enableStrongPassword":false,"displayDefaultContainerMemoryGB":6,"enableNotebookCommandMode":true,"disableS3TableImport":false,"deploymentMode":"production","useSpotForWorkers":true,"enableUserInviteWorkflow":true,"enableStaticNotebooks":true,"enableCssTransitions":true,"minClusterTagKeyLength":1,"showHomepageFeaturedLinks":true,"pricingURL":"https://databricks.com/product/pricing","enableClusterAclsConfig":false,"useTempS3UrlForTableUpload":false,"notifyLastLogin":false,"enableSshKeyUIByTier":false,"defaultAutomatedPricePerDBU":0.2,"enableNotebookGitVersioning":true,"files":"files/","feedbackEmail":"feedback@databricks.com","enableDriverLogsUI":true,"enableWorkspaceAclsConfig":false,"dropzoneMaxFileSize":2047,"enableNewClustersList":false,"enableNewDashboardViews":true,"driverLog4jFilePrefix":"log4j","enableSingleSignOn":true,"enableMavenLibraries":true,"displayRowLimit":1000,"deltaProcessingAsyncEnabled":true,"enableSparkEnvironmentVariablesUI":false,"defaultSparkVersion":{"key":"2.1.x-scala2.10","displayName":"Spark 2.1 (Auto-updating, Scala 2.10)","packageLabel":"spark-image-c7c0224de396cd1563addc1ae4bca6ba823780b6babe6c3729ddf73008f29ba4","upgradable":true,"deprecated":false,"customerVisible":true},"enableCustomSpotPricing":false,"enableMountAclsConfig":false,"defaultAutoterminationMin":180,"useDevTierHomePage":true,"enableClusterClone":true,"enableNotebookLineNumbers":true,"enablePublishHub":false,"notebookHubUrl":"http://hub.dev.databricks.com/","showSqlEndpoints":false,"enableClusterAclsByTier":false,"databricksDocsBaseUrl":"https://docs.databricks.com/","cloud":"AWS","disallowAddingAdmins":true,"enableSparkConfUI":true,"featureTier":"DEVELOPER_BASIC_TIER","mavenCentralSearchEndpoint":"http://search.maven.org/solrsearch/select","enableOrgSwitcherUI":true,"clustersLimit":1,"enableJdbcImport":true,"enableElasticDisk":false,"logfiles":"logfiles/","enableWebappSharding":true,"enableClusterDeltaUpdates":true,"enableSingleSignOnLogin":false,"ebsVolumeSizeLimitGB":{"GENERAL_PURPOSE_SSD":[100,4096],"THROUGHPUT_OPTIMIZED_HDD":[500,4096]},"enableMountAcls":false,"requireEmailUserName":true,"dbcFeedbackURL":"mailto:feedback@databricks.com","enableMountAclService":true,"enableWorkspaceAcls":false,"maxClusterTagKeyLength":127,"gitHash":"8cfae650235ae51451a79cd868de7b82ce94aa21","showWorkspaceFeaturedLinks":true,"signupUrl":"https://databricks.com/try-databricks","allowFeedbackForumAccess":true,"enableImportFromUrl":true,"enableMiniClusters":true,"enableNewTableUI":true,"enableDebugUI":false,"enableStreamingMetricsDashboard":true,"allowNonAdminUsers":true,"enableSingleSignOnByTier":false,"enableJobsRetryOnTimeout":true,"useStandardTierUpgradeTooltips":true,"staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/","enableSpotClusterType":true,"enableSparkPackages":true,"dynamicSparkVersions":true,"enableClusterTagsUIByTier":false,"enableNotebookHistoryUI":true,"enableClusterLoggingUI":true,"enableDatabaseDropdownInTableUI":false,"showDebugCounters":false,"enableInstanceProfilesUI":false,"enableFolderHtmlExport":true,"homepageFeaturedLinks":[{"linkURI":"https://docs.databricks.com/_static/notebooks/gentle-introduction-to-apache-spark.html","displayName":"Introduction to Apache Spark on Databricks","icon":"img/home/Python_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/databricks-for-data-scientists.html","displayName":"Databricks for Data Scientists","icon":"img/home/Scala_icon.svg"},{"linkURI":"https://docs.databricks.com/_static/notebooks/structured-streaming-python.html","displayName":"Introduction to Structured Streaming","icon":"img/home/Python_icon.svg"}],"enableClusterStart":true,"enableEBSVolumesUIByTier":false,"enableNewJobClusterEdit":false,"upgradeURL":"https://accounts.cloud.databricks.com/registration.html#login","maxAutoterminationMinutes":10000,"autoterminateClustersByDefault":true,"notebookLoadingBackground":"#fff","sshContainerForwardedPort":2200,"enableServerAutoComplete":true,"enableStaticHtmlImport":true,"enableInstanceProfilesByTier":false,"defaultMemoryPerContainerMB":6000,"enablePresenceUI":true,"minAutoterminationMinutes":10,"accounts":true,"useOnDemandClustersByDefault":true,"useFramedStaticNotebooks":false,"enableNewProgressReportUI":true,"defaultCoresPerContainer":4,"showTerminationReason":true,"enableNewClustersGet":true,"showPricePerDBU":false,"showSqlProxyUI":true};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":3619855571353653,"name":"movie-test","language":"python","commands":[{"version":"CommandV1","origId":2257638575419511,"guid":"b08d537d-af9a-414e-a6bf-277b5ccb11ce","subtype":"command","commandType":"auto","position":0.5,"command":"%md\n\n## Build a Movie Recommendation Model with Apache Spark and Amazon EMR\n\n**COMP4651 2017 Spring Project**\n\n*O Pui Wai, opw0011 | CHAN Hon Sum, samchan1995 | TSUI Ka Wai, kwtsui *\n\n<img src=\"https://raw.githubusercontent.com/hortonworks/data-tutorials/1f3893c64bbf5ffeae4f1a5cbf1bd667dcea6b06/tutorials/hdp/hdp-2.6/intro-to-machine-learning-with-apache-spark-and-apache-zeppelin/assets/spark-mllib-logo.png\" align=\"left\" height=\"100\" >\n<img src=\"https://conceptdraw.com/a3131c3/p1/preview/640/pict--amazon-emr-aws-analytics-vector-stencils-library\" width=\"140\">\n\n\n### Introduction\n\nIn this notebook, we are going to train a movie recommendation model using Spark MLib, a Spark's machine learning library . With the trained model, we can predict the movie ratings that a user is likely to give. As a result, we can make tailor-made moive recommendations based on the predicted rating, such listing out the top 25 highest rating moives that a user is likely to watch.   \n\n\n### Project Setup\n\nThe dataset is placed on AWS S3. In order to access the files, fill in the `ACCESS_KEY`, `SECRETE_KEY` and `AWS_BUCKET_NAME`.\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602628,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6f9f1416-4dd9-403b-92ff-0622f2621cff"},{"version":"CommandV1","origId":3619855571353655,"guid":"29572e40-bf11-4a5f-96aa-d5fa69f9a755","subtype":"command","commandType":"auto","position":1.0,"command":"# Set up AWS S3 access credentials\nACCESS_KEY = \"FILL_IN_YOUR_KEY_HERE\"\nSECRET_KEY = \"FILL_IN_YOUR_KEY_HERE\"\nENCODED_SECRET_KEY = SECRET_KEY.replace(\"/\", \"%2F\")\nAWS_BUCKET_NAME = \"comp4651-movie-data\"","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"java.rmi.RemoteException: java.lang.IllegalArgumentException: requirement failed: Directory already mounted: /mnt/movie-data; nested exception is: ","error":null,"workflows":[],"startTime":1495254603128,"submitTime":1495254602636,"finishTime":1495254603162,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c6bdd6e0-066a-4049-bb3c-af2290f5975a"},{"version":"CommandV1","origId":2257638575419512,"guid":"113666c8-391c-484a-af93-565a33603511","subtype":"command","commandType":"auto","position":1.25,"command":"%md\n\n#### Dataset Preparation\n\nThe dataset that is used for traning the model is downloaded from [MovieLens](https://grouplens.org/datasets/movielens/), a movie recommendation service.\n\nWe have downloaded two set the data:\n\nSmall: 100,000 ratings and 1,300 tag applications applied to 9,000 movies by 700 users. (compressed size: 1 MB) \n\n- [ml-latest-small.zip](http://files.grouplens.org/datasets/movielens/ml-latest-small.zip) (Last updated 10/2016)\n\nFull: 24,000,000 ratings and 670,000 tag applications applied to 40,000 movies by 260,000 users. (compressed size: 224 MB)\n- [ml-latest.zip](http://files.grouplens.org/datasets/movielens/ml-latest.zip) (Last updated 10/2016)\n\nThen, we have uploaded all the files to AWS S3:\n\n![s3](https://cloud.githubusercontent.com/assets/10897048/26273579/459ee37a-3d65-11e7-8460-215adf4e7335.png)\n\nSince the raw data are in csv format, we need to write a function to convert the raw data into Spark DataFrame.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602648,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"dc4d44fe-fb2f-4668-808a-c3ee551cee5e"},{"version":"CommandV1","origId":3619855571353660,"guid":"68ce21a2-6987-40fd-8f3c-c6ac9855ee1b","subtype":"command","commandType":"auto","position":1.5,"command":"# Convert csv file to Spark DataFrame (Databricks version)\ndef loadDataFrame(fileName, fileSchema):\n  return (spark.read.format(\"csv\")\n                    .schema(fileSchema)\n                    .option(\"header\", \"true\")\n                    .option(\"mode\", \"DROPMALFORMED\")\n                    .csv(\"s3a://%s:%s@%s/%s\" % (ACCESS_KEY, ENCODED_SECRET_KEY, AWS_BUCKET_NAME, fileName)))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1495254603169,"submitTime":1495254602676,"finishTime":1495254603212,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1121125d-4938-46a1-ae29-221dbd3a5711"},{"version":"CommandV1","origId":2257638575419513,"guid":"48e1da4b-4ae2-4fbc-8aad-49a869b5f4f9","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n\n#### Dataset Summary\n\n- `ratings-small.csv` is a small dataset extracted from the full rating dataset. It consists of the users' movie ratings, and has the following format:\n\n - `userId,movieId,rating,timestamp`\n\n- `movies-small.csv` is  a small dataset extracted from the full movie dataset. It consists of the details of the moive, and has the following format:\n\n - `movieId,title,genres`\n\nIn order to parse the csv into DataFrame, we have to explicitly specify the data type of each field. \n\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602688,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"79cdc935-da5f-4de3-9d09-0ca3da458003"},{"version":"CommandV1","origId":3878161896449524,"guid":"b459755e-d4bb-443b-8f12-765358edbc9f","subtype":"command","commandType":"auto","position":2.5,"command":"from pyspark.sql.types import *\n\nmovieRatingSchema = StructType([\n    StructField(\"userId\", IntegerType(), True),\n    StructField(\"movieId\", IntegerType(), True),\n    StructField(\"rating\", FloatType(), True),\n    StructField(\"timestamp\", StringType(), True)])\n\nmovieSchema = StructType([\n    StructField(\"movieId\", IntegerType(), True),\n    StructField(\"title\", StringType(), True),\n    StructField(\"genres\", StringType(), True)])\n\nsmallMovieRatingsDF = loadDataFrame(\"ratings-small.csv\", movieRatingSchema).cache()\nsmallMoviesDF = loadDataFrame(\"movies-small.csv\", movieSchema).cache()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;DataFrameReader&apos; object has no attribute &apos;shcema&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-43-211a03db4daf&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">     14</span>                     .csv(&quot;s3a://%s:%s@%s/%s&quot; % (ACCESS_KEY, ENCODED_SECRET_KEY, AWS_BUCKET_NAME, fileName)));\n<span class=\"ansigreen\">     15</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 16</span><span class=\"ansiyellow\"> </span>smallMovieRatingsDF <span class=\"ansiyellow\">=</span> loadDataFrame<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;ratings-small.csv&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>cache<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     17</span> <span class=\"ansired\">#smallMoviesDF = loadDataFrame(&quot;movies-small.csv&quot;).cache();</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">&lt;ipython-input-43-211a03db4daf&gt;</span> in <span class=\"ansicyan\">loadDataFrame</span><span class=\"ansiblue\">(fileName)</span>\n<span class=\"ansigreen\">      8</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      9</span> <span class=\"ansigreen\">def</span> loadDataFrame<span class=\"ansiyellow\">(</span>fileName<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 10</span><span class=\"ansiyellow\">   return (spark.read.format(&quot;csv&quot;)\n</span><span class=\"ansigreen\">     11</span>                     <span class=\"ansiyellow\">.</span>shcema<span class=\"ansiyellow\">(</span>customSchema<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     12</span>                     <span class=\"ansiyellow\">.</span>option<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;header&quot;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&quot;true&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;DataFrameReader&apos; object has no attribute &apos;shcema&apos;</div>","workflows":[],"startTime":1495254603218,"submitTime":1495254602705,"finishTime":1495254606351,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1c257596-dc74-4dd1-b3d2-d30c4f32d143"},{"version":"CommandV1","origId":3357449656074516,"guid":"3675144f-44a1-4f9c-9e78-2b3cf432e60d","subtype":"command","commandType":"auto","position":2.625,"command":"%md\n\nAfter successfully created the Dataframe, we can verify it by printing the DataFrame schema. \n\nAlso, we can write some code using the [Spark DataFrame API](http://spark.apache.org/docs/2.1.0/api/python/pyspark.sql.html#pyspark.sql.DataFrame) to get a more detailed dataset summary.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602717,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6ec664e9-eed0-4540-9b10-60056de9851f"},{"version":"CommandV1","origId":3878161896449525,"guid":"d36b3e9a-3a8d-43e3-876b-2b19b754de3f","subtype":"command","commandType":"auto","position":2.75,"command":"# Print out the DataFrame shcema, and a few lines as example\nsmallMovieRatingsDF.printSchema()\nsmallMovieRatingsDF.show(5)\n\nsmallMoviesDF.printSchema()\nsmallMoviesDF.show(5)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">root\n |-- userId: integer (nullable = true)\n |-- movieId: integer (nullable = true)\n |-- rating: float (nullable = true)\n |-- timestamp: string (nullable = true)\n\n+------+-------+------+----------+\n|userId|movieId|rating| timestamp|\n+------+-------+------+----------+\n|     1|     31|   2.5|1260759144|\n|     1|   1029|   3.0|1260759179|\n|     1|   1061|   3.0|1260759182|\n|     1|   1129|   2.0|1260759185|\n|     1|   1172|   4.0|1260759205|\n+------+-------+------+----------+\nonly showing top 5 rows\n\nroot\n |-- movieId: integer (nullable = true)\n |-- title: string (nullable = true)\n |-- genres: string (nullable = true)\n\n+-------+--------------------+--------------------+\n|movieId|               title|              genres|\n+-------+--------------------+--------------------+\n|      1|    Toy Story (1995)|Adventure|Animati...|\n|      2|      Jumanji (1995)|Adventure|Childre...|\n|      3|Grumpier Old Men ...|      Comedy|Romance|\n|      4|Waiting to Exhale...|Comedy|Drama|Romance|\n|      5|Father of the Bri...|              Comedy|\n+-------+--------------------+--------------------+\nonly showing top 5 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;smallMoiveRatingsDF&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-18-f45ea4bf0bc6&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansigreen\">print</span> smallMovieRatingsDF<span class=\"ansiyellow\">.</span>take<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">5</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansigreen\">print</span> smallMoviesDF<span class=\"ansiyellow\">.</span>take<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">5</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 3</span><span class=\"ansiyellow\"> </span>smallMoiveRatingsDF<span class=\"ansiyellow\">.</span>printSchema<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">;</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;smallMoiveRatingsDF&apos; is not defined</div>","workflows":[],"startTime":1495254606360,"submitTime":1495254602740,"finishTime":1495254606596,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a25c10c8-1795-4567-89eb-ae257b38a55a"},{"version":"CommandV1","origId":2245458040835285,"guid":"7a132ee6-8c51-465d-b7cd-4835e31448c8","subtype":"command","commandType":"auto","position":3.0625,"command":"from pyspark.sql.functions import mean, min, max, stddev\n\n# Data summary of the dataset\nprint \"Number of ratings: %s\" % (smallMovieRatingsDF.count())\nprint \"Number of distinct users: %s\" % (smallMovieRatingsDF.select('userId').distinct().count())\nprint \"Number of distinct movies: %s\" % (smallMovieRatingsDF.select('movieId').distinct().count())\nsmallMovieRatingsDF.select([mean('rating'), min('rating'), max('rating'), stddev('rating')]).show()\nsmallMovieRatingsDF.groupBy('rating').count().orderBy('rating').show()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Number of ratings: 100004\nNumber of distinct users: 671\nNumber of distinct movies: 9066\n+-----------------+-----------+-----------+-------------------+\n|      avg(rating)|min(rating)|max(rating)|stddev_samp(rating)|\n+-----------------+-----------+-----------+-------------------+\n|3.543608255669773|        0.5|        5.0| 1.0580641091070326|\n+-----------------+-----------+-----------+-------------------+\n\n+------+-----+\n|rating|count|\n+------+-----+\n|   0.5| 1101|\n|   1.0| 3326|\n|   1.5| 1687|\n|   2.0| 7271|\n|   2.5| 4449|\n|   3.0|20064|\n|   3.5|10538|\n|   4.0|28750|\n|   4.5| 7723|\n|   5.0|15095|\n+------+-----+\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;mean&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-28-ae9059cb38a1&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansigreen\">print</span> <span class=\"ansiblue\">&quot;Number of distinct users: %s&quot;</span> <span class=\"ansiyellow\">%</span> <span class=\"ansiyellow\">(</span>smallMovieRatingsDF<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;userId&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>distinct<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>count<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> <span class=\"ansigreen\">print</span> <span class=\"ansiblue\">&quot;Number of distinct movies: %s&quot;</span> <span class=\"ansiyellow\">%</span> <span class=\"ansiyellow\">(</span>smallMovieRatingsDF<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;movieId&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>distinct<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>count<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 5</span><span class=\"ansiyellow\"> </span>smallMovieRatingsDF<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">[</span>mean<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;rating&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> min<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;rating&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> max<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;rating&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      6</span> <span class=\"ansigreen\">print</span> <span class=\"ansiblue\">&quot;Rating Range: %s - %s&quot;</span> <span class=\"ansiyellow\">%</span> <span class=\"ansiyellow\">(</span>smallMovieRatingsDF<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span>min<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;rating&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>first<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> smallMovieRatingsDF<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span>max<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;rating&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>first<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      7</span> <span class=\"ansigreen\">print</span> <span class=\"ansiblue\">&quot;Average Rating: %s&quot;</span> <span class=\"ansiyellow\">%</span> <span class=\"ansiyellow\">(</span>smallMovieRatingsDF<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span>avg<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;rating&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>first<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;mean&apos; is not defined</div>","workflows":[],"startTime":1495254606605,"submitTime":1495254602751,"finishTime":1495254610083,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b6d9b408-4121-41ed-ae18-549ff45e91ce"},{"version":"CommandV1","origId":3357449656074518,"guid":"22292fb7-6d02-435a-8d98-524365f8fe9c","subtype":"command","commandType":"auto","position":3.21875,"command":"%md\n### Model Training\n\n#### Overview\n\nMLlib is Spark’s machine learning (ML) library. It provides high-level machine learning API to develop scalable machine learning program easily.\n\nSpark MLLib provides two machine learning packages, namely `spark.mllib` and `spark.ml`.\n\n`spark.mllib` consists of RDD-based APIs that supports RDD as the input parameters. However, it is expected that in Spark 2.2, the RDD-based API will be deprecated.\n\nOn the contrary, the DataFrame-based APIs in `spark.ml` is the latest trend in Spark, because DataFrames provide a more user-friendly API than RDDs. Besides, it has better execution performance, such as the Catalyst optimizations.\n\nFor more detailed explanations, please visit [Spark's offical MLlib guide](https://spark.apache.org/docs/2.1.0/ml-guide.html).\n\nAs suggested by Spark offical programming guide, we will mainly use the DataFrame-based [pyspark.ml.recommendation module](https://spark.apache.org/docs/2.1.0/api/python/pyspark.ml.html#module-pyspark.ml.recommendation) for doing collaborative filtering.\n\n#### Collaborative Filtering\n\nCoolaborative filtering make predictions about a user's interests by collecting preferences information from many users. It is based on the assumption that if a user A has the same opinion as a user B on an issue, then A is more likely to have B's opinion on a different issue. The image below illustrates this idea:\n\n![collaborative Filtering](https://upload.wikimedia.org/wikipedia/commons/5/52/Collaborative_filtering.gif) \n\n*(Image from [Wikipedia](https://en.wikipedia.org/wiki/Collaborative_filtering))*\n\nIn Spark ML library, it uses Alternating Least Squares (ALS) matrix factorization to perform recommendation. \n\n- rank is the number of latent factors in the model. In other words, it referes to the number of hidden factors of the real model.\n\n- regParam specifies the regularization parameter in ALS.\n\nOf course we do not know how many underlying factors for the real model, so we have to make a reasonalble guess on those paramters, and choose the best combination after doing evaluations.  \n\n\n#### Pick the Best ALS Parameters with Samll Dataset\n\nIn order to determine a good combination of model training parameters, we will split the small dataset into 3 non-overlapping subsets, namely traning (60%), validation (20%) and testing (20%), with [randomSplit](http://spark.apache.org/docs/2.1.0/api/python/pyspark.sql.html#pyspark.sql.DataFrame.randomSplit).\n\nThen, we have designed two list of parameters that will be used for traning:\n```\nranks = [2, 4, 8, 12, 16, 20, 24]\nregParams = [0.01, 0.05, 0.1, 0.15, 0.2, 0.3]\n```\nWe are going to train multiple models based on the training set. Then, we will pick the best model on the validation set with the least RMSE (Root Mean Squared Error). Finally, we will evaluate the best model on the testing set. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602764,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1891f8f9-ea42-44e2-90ff-e912c68c5f8c"},{"version":"CommandV1","origId":1584724551463082,"guid":"6e398ac9-4cc7-4d18-983d-5493303020b5","subtype":"command","commandType":"auto","position":3.375,"command":"# Partition the dataset into traning, validation and testing for cross-validation\n(trainingSet, validationSet, testingSet) = smallMovieRatingsDF.randomSplit([0.6, 0.2, 0.2], seed=12345)\ntraining = trainingSet.cache()\nvalidation = validationSet.cache()\ntesting = testingSet.cache()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1495254610096,"submitTime":1495254602789,"finishTime":1495254610184,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3aaaa6b3-8fe4-408c-beb9-7c61e436a6ee"},{"version":"CommandV1","origId":3619855571353661,"guid":"c9f98ae2-6de1-4ac8-b311-221653de9fdc","subtype":"command","commandType":"auto","position":4.0,"command":"# Use ml instead of mlib for Dataframes\n# http://spark.apache.org/docs/latest/api/python/pyspark.ml.html#pyspark.ml.recommendation.ALS\nfrom pyspark.ml.recommendation import ALS\nfrom pyspark.ml.evaluation import RegressionEvaluator\nfrom pyspark.sql import Row\nfrom time import time\n\nranks = [2, 4, 8, 12, 16, 20, 24]\nregParams = [0.01, 0.05, 0.1, 0.15, 0.2, 0.3]\nminError = float('inf')\nbestRank = -1\nbestRegParam = -1\nbestModel = None\n\n# An RMSE evaluator using the rating and predicted rating columns\nevaluator = RegressionEvaluator(metricName=\"rmse\", labelCol=\"rating\", predictionCol=\"prediction\")\n# Initialize the ASL(Alternating Least Squares)\nals = ALS(userCol = \"userId\", itemCol = \"movieId\", ratingCol = \"rating\", seed = 12345)\n\ntimeBegin = time()\n\nfor regParam in regParams:\n  for rank in ranks:\n    # Build the recommendation model using ALS on the training data\n    als.setParams(rank = rank, regParam = regParam)\n    model = als.fit(training)\n\n    # Evaluate the model by computing the RMSE on the validation data\n    predictions = model.transform(validation)\n    predictions = predictions.dropna() # drop all NaN prediction value to ensure not to have NaN RMSE (due to SPARK-14489)\n    error = evaluator.evaluate(predictions)\n    \n    if error < minError:\n      bestRank = rank\n      bestRegParam = regParam\n      minError = error\n      bestModel = model\n    print 'For rank %s, regParams %s, the RMSE is %s' % (rank, regParam, error)\n\ntimeElapsed = time() - timeBegin\nprint \"Trained %s models in %s seconds\" % (len(ranks) * len(regParams), round(timeElapsed, 3))\nprint(\"Best Rank = %s, Best regParam = %s, with RMSE = %s\"  % (bestRank, bestRegParam, minError))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">For rank 2, regParams 0.01, the RMSE is 1.04319473576\nFor rank 4, regParams 0.01, the RMSE is 1.10436267262\nFor rank 8, regParams 0.01, the RMSE is 1.21826892499\nFor rank 12, regParams 0.01, the RMSE is 1.26969715972\nFor rank 16, regParams 0.01, the RMSE is 1.32616652833\nFor rank 20, regParams 0.01, the RMSE is 1.35645610432\nFor rank 24, regParams 0.01, the RMSE is 1.40657975534\nFor rank 2, regParams 0.05, the RMSE is 0.96755228786\nFor rank 4, regParams 0.05, the RMSE is 0.984831042193\nFor rank 8, regParams 0.05, the RMSE is 1.02980383446\nFor rank 12, regParams 0.05, the RMSE is 1.0463948973\nFor rank 16, regParams 0.05, the RMSE is 1.05319477317\nFor rank 20, regParams 0.05, the RMSE is 1.05157652716\nFor rank 24, regParams 0.05, the RMSE is 1.04739278109\nFor rank 2, regParams 0.1, the RMSE is 0.94562247379\nFor rank 4, regParams 0.1, the RMSE is 0.938935472655\nFor rank 8, regParams 0.1, the RMSE is 0.953535430258\nFor rank 12, regParams 0.1, the RMSE is 0.954305903157\nFor rank 16, regParams 0.1, the RMSE is 0.955999683385\nFor rank 20, regParams 0.1, the RMSE is 0.952497447186\nFor rank 24, regParams 0.1, the RMSE is 0.95073758611\nFor rank 2, regParams 0.15, the RMSE is 0.937943037419\nFor rank 4, regParams 0.15, the RMSE is 0.923714959139\nFor rank 8, regParams 0.15, the RMSE is 0.929057053221\nFor rank 12, regParams 0.15, the RMSE is 0.929453640671\nFor rank 16, regParams 0.15, the RMSE is 0.930103850678\nFor rank 20, regParams 0.15, the RMSE is 0.929151149082\nFor rank 24, regParams 0.15, the RMSE is 0.930462488894\nFor rank 2, regParams 0.2, the RMSE is 0.938739919492\nFor rank 4, regParams 0.2, the RMSE is 0.923620032612\nFor rank 8, regParams 0.2, the RMSE is 0.926191722397\nFor rank 12, regParams 0.2, the RMSE is 0.927326163415\nFor rank 16, regParams 0.2, the RMSE is 0.927407466564\nFor rank 20, regParams 0.2, the RMSE is 0.927757753985\nFor rank 24, regParams 0.2, the RMSE is 0.929563280434\nFor rank 2, regParams 0.3, the RMSE is 0.956381897669\nFor rank 4, regParams 0.3, the RMSE is 0.947972925437\nFor rank 8, regParams 0.3, the RMSE is 0.948704315182\nFor rank 12, regParams 0.3, the RMSE is 0.950251929706\nFor rank 16, regParams 0.3, the RMSE is 0.950167148961\nFor rank 20, regParams 0.3, the RMSE is 0.950257950197\nFor rank 24, regParams 0.3, the RMSE is 0.951246373942\nTrained 42 models in 779.242 seconds\nBest Rank = 4, Best regParam = 0.2, with RMSE = 0.923620032612\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1495254610193,"submitTime":1495254602801,"finishTime":1495255389743,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e9d1ea38-705e-45e7-9653-cece58f8f047"},{"version":"CommandV1","origId":1584724551463083,"guid":"9a7dfe75-6a31-4842-8a29-14262620c64d","subtype":"command","commandType":"auto","position":4.5,"command":"# After getting the best rank and RegParam, test the model on test dataset\npredictions = bestModel.transform(testing)\npredictions = predictions.dropna() # drop all NaN prediction value to ensure not to have NaN RMSE (due to SPARK-14489)\nrmse = evaluator.evaluate(predictions)\nprint(\"The model had a RMSE of %s on test dataset\"  % (rmse))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">The model had a RMSE of 0.921357133499 on test dataset\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1495255389765,"submitTime":1495254602813,"finishTime":1495255402959,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a9b4a436-efc0-47c6-94e2-a6b61113cc1c"},{"version":"CommandV1","origId":3357449656074519,"guid":"8d011d05-419f-45d2-98bb-b5731e6245fd","subtype":"command","commandType":"auto","position":5.4375,"command":"%md\n#### Train the Model with Full Dataset\n\nAfter we have found out the best training parameters with the samll dataset, now we are going to use them for training the full dataset (~600MB in size).\n\nDuring the traning, we will record the time spent to train the whole dataset.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602823,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"177f2c12-4ca9-455b-8ad0-b35316d39ce8"},{"version":"CommandV1","origId":1584724551463130,"guid":"42991ceb-1df8-4f9a-9d09-56bd61c4a867","subtype":"command","commandType":"auto","position":6.375,"command":"# Train the full data set and calculate the time elapsed\nMovieRatingsDF = loadDataFrame(\"ratings.csv\", movieRatingSchema).cache()\nMoviesDF = loadDataFrame(\"movies.csv\", movieSchema).cache()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1495255402967,"submitTime":1495254602850,"finishTime":1495255405917,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"11f43bd2-4311-4fe1-aa57-e5e1bc170369"},{"version":"CommandV1","origId":822182306953814,"guid":"cf20d524-96db-4b7c-97f2-44df164660d3","subtype":"command","commandType":"auto","position":7.1875,"command":"# Data summary of the full dataset on movie rating\nprint \"Number of ratings: %s\" % (MovieRatingsDF.count())\nprint \"Number of distinct users: %s\" % (MovieRatingsDF.select('userId').distinct().count())\nprint \"Number of rated distinct movies: %s\" % (MovieRatingsDF.select('movieId').distinct().count())\nprint \"Total number of movies: %s\" % (MoviesDF.select('movieId').count())\n\nMovieRatingsDF.select([mean('rating'), min('rating'), max('rating'), stddev('rating')]).show()\n\nprint \"Distribution of ratings:\"\nMovieRatingsDF.groupBy('rating').count().orderBy('rating').show()\nRatingsCountGroupByMovieId = MovieRatingsDF.groupBy('movieId').count()\nprint \"Average number of ratings per movie: %s\" % (RatingsCountGroupByMovieId.select(mean('count')).first())","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Number of ratings: 24404096\nNumber of distinct users: 259137\nNumber of rated distinct movies: 39443\nTotal number of movies: 40110\n+------------------+-----------+-----------+-------------------+\n|       avg(rating)|min(rating)|max(rating)|stddev_samp(rating)|\n+------------------+-----------+-----------+-------------------+\n|3.5265681220070597|        0.5|        5.0| 1.0642182955183275|\n+------------------+-----------+-----------+-------------------+\n\nDistribution of ratings:\n+------+-------+\n|rating|  count|\n+------+-------+\n|   0.5| 361006|\n|   1.0| 807991|\n|   1.5| 369879|\n|   2.0|1681993|\n|   2.5|1145168|\n|   3.0|5011914|\n|   3.5|2840765|\n|   4.0|6620340|\n|   4.5|1984982|\n|   5.0|3580058|\n+------+-------+\n\nAverage number of ratings per movie: 618.71804883\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">TypeError</span>: cannot concatenate &apos;str&apos; and &apos;int&apos; objects","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">TypeError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-58-e47fd0b4e3b5&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">     11</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     12</span> NUM_RATING_AT_LEAST <span class=\"ansiyellow\">=</span> <span class=\"ansicyan\">50</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 13</span><span class=\"ansiyellow\"> </span>MovieWithAtLeastNRatings <span class=\"ansiyellow\">=</span> RatingsCountGroupByMovieId<span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;count &gt;=&apos;</span> <span class=\"ansiyellow\">+</span> NUM_RATING_AT_LEAST<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">TypeError</span>: cannot concatenate &apos;str&apos; and &apos;int&apos; objects</div>","workflows":[],"startTime":1495255405928,"submitTime":1495254602861,"finishTime":1495255415373,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"245149aa-7de5-4642-9191-101bdc437b48"},{"version":"CommandV1","origId":822182306953815,"guid":"50d48c74-1289-4d71-bbae-93e43625784c","subtype":"command","commandType":"auto","position":7.59375,"command":"als.setParams(rank = bestRank, regParam = bestRegParam)\nprint \"Training full data set with Rank = %s, regParam = %s ...\" % (bestRank, bestRegParam)\n\ntimeBegin = time()\n\nmodel = als.fit(MovieRatingsDF) # use the full dataset for training\n\ntimeElapsed = time() - timeBegin\n\nprint \"Final model trained in %s seconds\" % round(timeElapsed, 3)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Training full data set with Rank = 4, regParam = 0.2 ...\nFinal model trained in 203.703 seconds\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1495255415391,"submitTime":1495254602871,"finishTime":1495255619146,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"357e09f2-39e7-4528-b55c-5c4dea263af5"},{"version":"CommandV1","origId":822182306953816,"guid":"677416f4-2ec7-4961-80e8-358a10d440ef","subtype":"command","commandType":"auto","position":7.796875,"command":"# Evaluate the performance of the final model with the testing data\npredictions = model.transform(testing)\npredictions = predictions.dropna() # drop all NaN prediction value to ensure not to have NaN RMSE (due to SPARK-14489)\nrmse = evaluator.evaluate(predictions)\nprint(\"The final model had a RMSE of %s\"  % (rmse))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">The final model had a RMSE of 1.06072565822\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1495255619153,"submitTime":1495254602881,"finishTime":1495255634681,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5b8a66d7-da46-4276-9159-d374b2fab87c"},{"version":"CommandV1","origId":3357449656074520,"guid":"fe62a13f-5328-4fca-b9c6-c6ba6d30da42","subtype":"command","commandType":"auto","position":7.84765625,"command":"%md\n### Moive Recommendations\n\nAfter we have trained the model, now it is time to use the model to predict users' movie ratings.\n\nThe high level idea is like that:\n\n1. We pick a user, and get a list of movie that he/she has rated.\n\n2. From the full movie list, we exclude all the moive that the user has rated, and construct a list of un-rated movie list.\n\n3. The movies in the un-rated list are now in the pool of recommendation. They are then inputed into the model.\n\n4. Now, each un-rated movies will get a unique predicted rating based other similar users' ratings. \n\n5. Finally, we simply do a sorting to find the top N moives with the highest predicted rating. Besides, we can also make recommendation based on moive's categories.\n\n#### Our First Try\n\nWe follow the idea illustrated above and pick a user with UserId = 1000, and try to make a movie recommendation to him/her.\n\nIn the following example, we try to print out some movies that he/she has and has not watched before respectively, and then make predictions on all the unwatched movies. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602891,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a8271f6c-745d-482c-b7a4-ac5b6d0f9d0f"},{"version":"CommandV1","origId":822182306953817,"guid":"b8fc829f-7636-441c-97da-db7b2fe0a49a","subtype":"command","commandType":"auto","position":7.8984375,"command":"from pyspark.sql.functions import lit\nUserId = 1000\nuserWatchedList = (MovieRatingsDF.filter(MovieRatingsDF.userId == UserId)\n                                 .join(MoviesDF, 'movieId')\n                                 .select(['movieId', 'userId', 'title', 'rating']))\nwatchedMovieList = []\nfor movie in userWatchedList.collect():\n  watchedMovieList.append(movie.movieId)\nprint \"User %s has watched and rated %s moive (sorted by rating):\" % (UserId, len(watchedMovieList)) \nuserWatchedList.orderBy('rating', ascending = False).show(20, False)\n\n# find out the unwatched list and append with the userid\nuserUnwatchedList = (MoviesDF.filter(MoviesDF.movieId.isin(watchedMovieList) == False).withColumn('userId', lit(UserId)).cache())\nprint \"%s unwatched movie:\" % (userUnwatchedList.count())\nuserUnwatchedList.show(20, False)\n\npredictedMovies = model.transform(userUnwatchedList)\npredictedMovies = predictedMovies.dropna().cache() # drop all NaN prediction value to ensure not to have NaN RMSE (due to SPARK-14489)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">User 1000 has watched and rated 49 moive (sorted by rating):\n+-------+------+--------------------------------------------+------+\n|movieId|userId|title                                       |rating|\n+-------+------+--------------------------------------------+------+\n|7361   |1000  |Eternal Sunshine of the Spotless Mind (2004)|5.0   |\n|8784   |1000  |Garden State (2004)                         |5.0   |\n|2762   |1000  |Sixth Sense, The (1999)                     |5.0   |\n|46578  |1000  |Little Miss Sunshine (2006)                 |5.0   |\n|111362 |1000  |X-Men: Days of Future Past (2014)           |5.0   |\n|1265   |1000  |Groundhog Day (1993)                        |5.0   |\n|4878   |1000  |Donnie Darko (2001)                         |5.0   |\n|92259  |1000  |Intouchables (2011)                         |5.0   |\n|527    |1000  |Schindler&apos;s List (1993)                     |4.5   |\n|60069  |1000  |WALL·E (2008)                               |4.5   |\n|8972   |1000  |National Treasure (2004)                    |4.0   |\n|2959   |1000  |Fight Club (1999)                           |4.0   |\n|33794  |1000  |Batman Begins (2005)                        |4.0   |\n|106920 |1000  |Her (2013)                                  |4.0   |\n|3147   |1000  |Green Mile, The (1999)                      |4.0   |\n|356    |1000  |Forrest Gump (1994)                         |4.0   |\n|45499  |1000  |X-Men: The Last Stand (2006)                |4.0   |\n|58559  |1000  |Dark Knight, The (2008)                     |4.0   |\n|8961   |1000  |Incredibles, The (2004)                     |4.0   |\n|6333   |1000  |X2: X-Men United (2003)                     |4.0   |\n+-------+------+--------------------------------------------+------+\nonly showing top 20 rows\n\n40061 unwatched movie:\n+-------+-------------------------------------+-------------------------------------------+------+\n|movieId|title                                |genres                                     |userId|\n+-------+-------------------------------------+-------------------------------------------+------+\n|1      |Toy Story (1995)                     |Adventure|Animation|Children|Comedy|Fantasy|1000  |\n|2      |Jumanji (1995)                       |Adventure|Children|Fantasy                 |1000  |\n|3      |Grumpier Old Men (1995)              |Comedy|Romance                             |1000  |\n|4      |Waiting to Exhale (1995)             |Comedy|Drama|Romance                       |1000  |\n|5      |Father of the Bride Part II (1995)   |Comedy                                     |1000  |\n|6      |Heat (1995)                          |Action|Crime|Thriller                      |1000  |\n|7      |Sabrina (1995)                       |Comedy|Romance                             |1000  |\n|8      |Tom and Huck (1995)                  |Adventure|Children                         |1000  |\n|9      |Sudden Death (1995)                  |Action                                     |1000  |\n|10     |GoldenEye (1995)                     |Action|Adventure|Thriller                  |1000  |\n|11     |American President, The (1995)       |Comedy|Drama|Romance                       |1000  |\n|12     |Dracula: Dead and Loving It (1995)   |Comedy|Horror                              |1000  |\n|13     |Balto (1995)                         |Adventure|Animation|Children               |1000  |\n|14     |Nixon (1995)                         |Drama                                      |1000  |\n|15     |Cutthroat Island (1995)              |Action|Adventure|Romance                   |1000  |\n|16     |Casino (1995)                        |Crime|Drama                                |1000  |\n|17     |Sense and Sensibility (1995)         |Drama|Romance                              |1000  |\n|18     |Four Rooms (1995)                    |Comedy                                     |1000  |\n|19     |Ace Ventura: When Nature Calls (1995)|Comedy                                     |1000  |\n|20     |Money Train (1995)                   |Action|Comedy|Crime|Drama|Thriller         |1000  |\n+-------+-------------------------------------+-------------------------------------------+------+\nonly showing top 20 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> invalid syntax","error":"<div class=\"ansiout\"><span class=\"ansicyan\">  File </span><span class=\"ansigreen\">&quot;&lt;ipython-input-101-513b25c8059b&gt;&quot;</span><span class=\"ansicyan\">, line </span><span class=\"ansigreen\">8</span>\n<span class=\"ansiyellow\">    userWatchedList.orderBy(&apos;rating&apos;)show(20, False)</span>\n<span class=\"ansigrey\">                                        ^</span>\n<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> invalid syntax\n</div>","workflows":[],"startTime":1495255634695,"submitTime":1495254602905,"finishTime":1495255638730,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4dc4cf67-db89-422c-861a-99fb04988940"},{"version":"CommandV1","origId":3357449656074522,"guid":"d56e0cf8-99de-491c-a4c9-e81e6c957e81","subtype":"command","commandType":"auto","position":7.923828125,"command":"%md\n#### Our First Try Result\n\nAs you can see in the folliwng, we have list out the top 25 moives with the highest rating. \n\nHowever, we got some strange movies that have not be heard before. For example, take \"The Thorn (1971)\" as an example, try to search it on IMDB.\n\n![the-thorn](https://cloud.githubusercontent.com/assets/10897048/26272746/1e6cdc38-3d53-11e7-9483-554bf6b98e2d.png)\n\n**The problem is ONLY 48 people have rated this moive!**\n\nSince the sampling size is relatively too small, it may not be representative. There might be some biases on the ratings. Besides, a user may not be interested in watching unpopular moive. In order to fix this problem, we need to filter out those unknown movies.\n\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602915,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"49741074-389b-4b96-8ce2-ed301d55546d"},{"version":"CommandV1","origId":2257638575419400,"guid":"842f45f4-d12b-43fb-959e-10768458377d","subtype":"command","commandType":"auto","position":7.94921875,"command":"print \"Top 25 predicted movie with highest rating:\"\ntop25Movies = predictedMovies.orderBy('prediction', ascending = False).show(25, False)\n\nprint \"Top 25 commedy with highest rating:\"\ntop25Comedy = (predictedMovies.filter(predictedMovies.genres.like(\"%Comedy%\"))\n                              .orderBy('prediction', ascending = False)\n                              .show(25, False))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Top 25 predicted movie with highest rating:\n+-------+------------------------------------------------------+------------------+------+----------+\n|movieId|title                                                 |genres            |userId|prediction|\n+-------+------------------------------------------------------+------------------+------+----------+\n|151989 |The Thorn (1971)                                      |Comedy            |1000  |6.578957  |\n|107434 |Diplomatic Immunity (2009– )                          |Comedy            |1000  |5.872571  |\n|107252 |Island at War (2004)                                  |Drama|War         |1000  |5.872571  |\n|162368 |The Russian Woodpecker (2015)                         |Documentary       |1000  |5.7832417 |\n|156801 |The Magician (1898)                                   |Drama|Fantasy     |1000  |5.737047  |\n|164937 |Love Is Blind (2013)                                  |Drama|Romance     |1000  |5.4767203 |\n|144202 |Catch That Girl (2002)                                |Action|Children   |1000  |5.42736   |\n|151615 |Hello Stranger (2010)                                 |Drama             |1000  |5.415135  |\n|110108 |Asphalt Playground (La cité rose) (2012)              |Comedy            |1000  |5.3135514 |\n|162876 |Big Beat (1993)                                       |Comedy            |1000  |5.2903347 |\n|132912 |Emmanuelle 5 (1987)                                   |(no genres listed)|1000  |5.244452  |\n|139074 |The Marriage of Figaro (1975)                         |Comedy            |1000  |5.2198753 |\n|105144 |Bare Knuckles (2010)                                  |Action|Drama      |1000  |5.2146783 |\n|155619 |Neue Vahr Süd (2010)                                  |Comedy            |1000  |5.2047954 |\n|143571 |Private Practices: The Story of a Sex Surrogate (1986)|Documentary       |1000  |5.1819534 |\n|139126 |The Third Lover (1962)                                |(no genres listed)|1000  |5.1810985 |\n|147402 |The King and Queen of Moonlight Bay (2003)            |Children|Drama    |1000  |5.1076403 |\n|156414 |Life Even Looks Like a Party (2009)                   |Documentary       |1000  |5.0944185 |\n|117352 |A Kind of America 2 (2008)                            |Comedy            |1000  |5.0827765 |\n|141416 |Muhammad (2015)                                       |Drama             |1000  |5.0816407 |\n|158832 |The Store (1983)                                      |Documentary       |1000  |5.0661473 |\n|143641 |South (1919)                                          |Documentary       |1000  |5.053427  |\n|123567 |IMAX - Roving Mars (2006)                             |Documentary       |1000  |5.039404  |\n|154290 |100 Million BC (2008)                                 |Sci-Fi            |1000  |5.038984  |\n|134789 |If You Were Young: Rage (1970)                        |Drama             |1000  |5.0188637 |\n+-------+------------------------------------------------------+------------------+------+----------+\nonly showing top 25 rows\n\nTop 25 commedy with highest rating:\n+-------+------------------------------------------------+-------------------------------------------+------+----------+\n|movieId|title                                           |genres                                     |userId|prediction|\n+-------+------------------------------------------------+-------------------------------------------+------+----------+\n|151989 |The Thorn (1971)                                |Comedy                                     |1000  |6.578957  |\n|107434 |Diplomatic Immunity (2009– )                    |Comedy                                     |1000  |5.872571  |\n|110108 |Asphalt Playground (La cité rose) (2012)        |Comedy                                     |1000  |5.3135514 |\n|162876 |Big Beat (1993)                                 |Comedy                                     |1000  |5.2903347 |\n|139074 |The Marriage of Figaro (1975)                   |Comedy                                     |1000  |5.2198753 |\n|155619 |Neue Vahr Süd (2010)                            |Comedy                                     |1000  |5.2047954 |\n|117352 |A Kind of America 2 (2008)                      |Comedy                                     |1000  |5.0827765 |\n|155713 |Boys Will Be Boys (1935)                        |Comedy                                     |1000  |4.9651446 |\n|129905 |The Floating Castle (2012)                      |Comedy|Drama                               |1000  |4.932844  |\n|148791 |Paris Follies (2014)                            |Comedy                                     |1000  |4.931772  |\n|131904 |Surf II (1984)                                  |Comedy                                     |1000  |4.9044647 |\n|149446 |Petty Romance (2010)                            |Comedy|Drama                               |1000  |4.851333  |\n|158318 |Dave Attell&apos;s Insomniac Tour: Uncensored! (2005)|Comedy                                     |1000  |4.8385673 |\n|163769 |Our Tropical Island (2001)                      |Comedy                                     |1000  |4.828187  |\n|99243  |Parasites, Les (1999)                           |Comedy                                     |1000  |4.7986274 |\n|161922 |The Edge of Seventeen (2016)                    |Comedy                                     |1000  |4.7812443 |\n|136265 |Satyricon (1969)                                |Comedy                                     |1000  |4.7521706 |\n|110293 |Table 7 (2010)                                  |Comedy|Drama                               |1000  |4.7501745 |\n|109571 |Into the Middle of Nowhere (2010)               |Adventure|Children|Comedy|Documentary|Drama|1000  |4.7118907 |\n|109715 |Inquire Within (2012)                           |Comedy                                     |1000  |4.7118907 |\n|120313 |Otakus in Love (2004)                           |Comedy|Drama|Romance                       |1000  |4.69809   |\n|139974 |Cari fottutissimi amici (1994)                  |Comedy                                     |1000  |4.695095  |\n|138492 |Qualunquemente (2011)                           |Comedy                                     |1000  |4.6827765 |\n|138620 |Christian Finnegan: The Fun Part (2014)         |Comedy                                     |1000  |4.6435614 |\n|131644 |The Great American Girl Robbery (1979)          |Comedy|Crime                               |1000  |4.6385264 |\n+-------+------------------------------------------------+-------------------------------------------+------+----------+\nonly showing top 25 rows\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1495255638765,"submitTime":1495254602937,"finishTime":1495255646648,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7353c0b0-ba4a-4e7e-8b21-ed0b1103f66c"},{"version":"CommandV1","origId":3357449656074521,"guid":"fa6d9bcc-2e1a-4189-8417-d2a8cb94446f","subtype":"command","commandType":"auto","position":7.9619140625,"command":"%md\n#### Our Second Try\n\nThis time we will filter out movies with less than 50 ratings, and then exclude them in the recommendation pool. We have excluded 27575 moives with less than 50 ratings.\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254602948,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d94a767a-22f0-4fcb-8fc0-2a7fa89af02f"},{"version":"CommandV1","origId":2257638575419401,"guid":"12188dd4-1ae6-4fe5-97ea-5304d19ff72a","subtype":"command","commandType":"auto","position":7.974609375,"command":"N = 50\nMovieWithLessThanNRatings = RatingsCountGroupByMovieId.filter('count <' + str(N))\nprint \"Movies with less than %s rating count: %s\" % (N, MovieWithLessThanNRatings.count())\n\nmovieToBeExcluded = []\nfor movie in MovieWithLessThanNRatings.collect():\n  movieToBeExcluded.append(movie.movieId)\n  \nuserUnwatchedListWithAtLeastNRatings = userUnwatchedList.filter(userUnwatchedList.movieId.isin(movieToBeExcluded) == False).cache()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Movies with less than 50 rating count: 27575\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Cancelled","error":null,"workflows":[],"startTime":1495255646666,"submitTime":1495254603032,"finishTime":1495255726340,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4e4c5455-e4ff-4b2c-9482-8a9812754307"},{"version":"CommandV1","origId":2257638575419402,"guid":"f94084bd-da7a-4cb7-9dcf-779dda787124","subtype":"command","commandType":"auto","position":7.9873046875,"command":"timeBegin = time()\n\npredictedMovies = model.transform(userUnwatchedListWithAtLeastNRatings)\npredictedMovies = predictedMovies.dropna().cache() # drop all NaN prediction value to ensure not to have NaN RMSE (due to SPARK-14489)\n\ntimeElapsed = time() - timeBegin\nprint \"Final model make prediction in %s seconds\" % round(timeElapsed, 3)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Final model make prediction in 0.455 seconds\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1495255726343,"submitTime":1495254603041,"finishTime":1495255726866,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d5e303e8-1842-4f0b-ab26-e837df572e22"},{"version":"CommandV1","origId":3132269910568308,"guid":"32b81b53-5186-4395-8886-375cf87f1569","subtype":"command","commandType":"auto","position":7.990478515625,"command":"%md\n#### Our Second Try Result\n\nThis time you can see that in our top recommendations list, all those unpopular movies has been excluded. \n\nNow, the top recommendation is \"Planet Earth (2006)\", which looks to be a suprisingly good rating moive that worth to be watched! \n\n![planet-earth](https://cloud.githubusercontent.com/assets/10897048/26272914/a4750c62-3d56-11e7-9f90-7b4c0882376c.png)\n\nWe can also list out the top rating based on the moive categories. \n\n**Now we have successfully build a practical movide recommendation model!**\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254603050,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7b85606e-284e-4203-bd68-0983e3244f72"},{"version":"CommandV1","origId":2257638575419403,"guid":"3fda8f9e-4829-4de9-bd8f-750c737c4110","subtype":"command","commandType":"auto","position":7.99365234375,"command":"print \"Top 25 predicted movie with highest rating:\"\ntimeBegin1 = time()\ntop25Movies = predictedMovies.orderBy('prediction', ascending = False).show(25, False)\ntimeElapsed1 = time() - timeBegin1\nprint \"Took %s seconds\" % round(timeElapsed1, 3)\n\nprint \"Top 25 commedy with highest rating:\"\ntimeBegin2 = time()\ntop25Comedy = (predictedMovies.filter(predictedMovies.genres.like(\"%Comedy%\"))\n                              .orderBy('prediction', ascending = False)\n                              .show(25, False))\ntimeElapsed2 = time() - timeBegin2\nprint \"Took %s seconds\" % round(timeElapsed2, 3)\n\nprint \"Top 25 Science Fiction with highest rating:\"\ntimeBegin3 = time()\ntop25SciFi = (predictedMovies.filter(predictedMovies.genres.like(\"%Sci-Fi%\"))\n                             .orderBy('prediction', ascending = False)\n                             .show(25, False))\ntimeElapsed3 = time() - timeBegin3\nprint \"Took %s seconds\" % round(timeElapsed3, 3)\n\nprint \"Top 25 Animation with highest rating:\"\ntimeBegin4 = time()\ntop25Anim = (predictedMovies.filter(predictedMovies.genres.like(\"%Animation%\"))\n                             .orderBy('prediction', ascending = False)\n                             .show(25, False))\ntimeElapsed4 = time() - timeBegin4\nprint \"Took %s seconds\" % round(timeElapsed4, 3)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Top 25 predicted movie with highest rating:\n+-------+----------------------------------------------------------+---------------------------+------+----------+\n|movieId|title                                                     |genres                     |userId|prediction|\n+-------+----------------------------------------------------------+---------------------------+------+----------+\n|159817 |Planet Earth (2006)                                       |Documentary                |1000  |4.36826   |\n|142115 |The Blue Planet (2001)                                    |(no genres listed)         |1000  |4.248148  |\n|858    |Godfather, The (1972)                                     |Crime|Drama                |1000  |4.1844883 |\n|162376 |Stranger Things                                           |Drama                      |1000  |4.180185  |\n|136445 |George Carlin: Back in Town (1996)                        |Comedy                     |1000  |4.177131  |\n|160718 |Piper (2016)                                              |Animation                  |1000  |4.1754093 |\n|50     |Usual Suspects, The (1995)                                |Crime|Mystery|Thriller     |1000  |4.1577106 |\n|94466  |Black Mirror (2011)                                       |Drama|Sci-Fi               |1000  |4.1427    |\n|100044 |Human Planet (2011)                                       |Documentary                |1000  |4.140124  |\n|77658  |Cosmos (1980)                                             |Documentary                |1000  |4.130395  |\n|134849 |Duck Amuck (1953)                                         |Animation|Children|Comedy  |1000  |4.116488  |\n|100553 |Frozen Planet (2011)                                      |Documentary                |1000  |4.115645  |\n|1221   |Godfather: Part II, The (1974)                            |Crime|Drama                |1000  |4.111619  |\n|7502   |Band of Brothers (2001)                                   |Action|Drama|War           |1000  |4.105418  |\n|136447 |George Carlin: You Are All Diseased (1999)                |Comedy                     |1000  |4.102854  |\n|2019   |Seven Samurai (Shichinin no samurai) (1954)               |Action|Adventure|Drama     |1000  |4.100775  |\n|904    |Rear Window (1954)                                        |Mystery|Thriller           |1000  |4.0952754 |\n|44555  |Lives of Others, The (Das leben der Anderen) (2006)       |Drama|Romance|Thriller     |1000  |4.0949025 |\n|1203   |12 Angry Men (1957)                                       |Drama                      |1000  |4.094406  |\n|108583 |Fawlty Towers (1975-1979)                                 |Comedy                     |1000  |4.0903835 |\n|1193   |One Flew Over the Cuckoo&apos;s Nest (1975)                    |Drama                      |1000  |4.081561  |\n|101850 |Death on the Staircase (Soupçons) (2004)                  |Crime|Documentary          |1000  |4.080574  |\n|107412 |Kidnapping, Caucasian Style (Kavkazskaya plennitsa) (1967)|Comedy|Romance             |1000  |4.0747166 |\n|912    |Casablanca (1942)                                         |Drama|Romance              |1000  |4.0730057 |\n|5618   |Spirited Away (Sen to Chihiro no kamikakushi) (2001)      |Adventure|Animation|Fantasy|1000  |4.072469  |\n+-------+----------------------------------------------------------+---------------------------+------+----------+\nonly showing top 25 rows\n\nTook 19.797 seconds\nTop 25 commedy with highest rating:\n+-------+---------------------------------------------------------------------------+---------------------------------------+------+----------+\n|movieId|title                                                                      |genres                                 |userId|prediction|\n+-------+---------------------------------------------------------------------------+---------------------------------------+------+----------+\n|136445 |George Carlin: Back in Town (1996)                                         |Comedy                                 |1000  |4.177131  |\n|134849 |Duck Amuck (1953)                                                          |Animation|Children|Comedy              |1000  |4.116488  |\n|136447 |George Carlin: You Are All Diseased (1999)                                 |Comedy                                 |1000  |4.102854  |\n|108583 |Fawlty Towers (1975-1979)                                                  |Comedy                                 |1000  |4.0903835 |\n|107412 |Kidnapping, Caucasian Style (Kavkazskaya plennitsa) (1967)                 |Comedy|Romance                         |1000  |4.0747166 |\n|27423  |O Auto da Compadecida (Dog&apos;s Will, A) (2000)                               |Adventure|Comedy                       |1000  |4.046599  |\n|750    |Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb (1964)|Comedy|War                             |1000  |4.0418878 |\n|116897 |Wild Tales (2014)                                                          |Comedy|Drama|Thriller                  |1000  |4.0417557 |\n|130970 |George Carlin: Life Is Worth Losing (2005)                                 |Comedy                                 |1000  |4.0398064 |\n|296    |Pulp Fiction (1994)                                                        |Comedy|Crime|Drama|Thriller            |1000  |4.0273275 |\n|1136   |Monty Python and the Holy Grail (1975)                                     |Adventure|Comedy|Fantasy               |1000  |4.02704   |\n|4973   |Amelie (Fabuleux destin d&apos;Amélie Poulain, Le) (2001)                       |Comedy|Romance                         |1000  |4.026161  |\n|60904  |Heart of a Dog (Sobachye serdtse) (1988)                                   |Comedy|Drama|Sci-Fi                    |1000  |4.0251846 |\n|1148   |Wallace &amp; Gromit: The Wrong Trousers (1993)                                |Animation|Children|Comedy|Crime        |1000  |4.0250235 |\n|1234   |Sting, The (1973)                                                          |Comedy|Crime                           |1000  |4.0247    |\n|148881 |World of Tomorrow (2015)                                                   |Animation|Comedy                       |1000  |4.024053  |\n|127052 |Operation &apos;Y&apos; &amp; Other Shurik&apos;s Adventures (1965)                           |Comedy|Crime|Romance                   |1000  |4.0109677 |\n|745    |Wallace &amp; Gromit: A Close Shave (1995)                                     |Animation|Children|Comedy              |1000  |4.000136  |\n|950    |Thin Man, The (1934)                                                       |Comedy|Crime                           |1000  |3.9968505 |\n|33779  |Eddie Izzard: Dress to Kill (1999)                                         |Comedy                                 |1000  |3.9955735 |\n|905    |It Happened One Night (1934)                                               |Comedy|Romance                         |1000  |3.9942493 |\n|1197   |Princess Bride, The (1987)                                                 |Action|Adventure|Comedy|Fantasy|Romance|1000  |3.991812  |\n|152970 |Hunt for the Wilderpeople (2016)                                           |Adventure|Comedy                       |1000  |3.9883323 |\n|3429   |Creature Comforts (1989)                                                   |Animation|Comedy                       |1000  |3.9834394 |\n|898    |Philadelphia Story, The (1940)                                             |Comedy|Drama|Romance                   |1000  |3.977098  |\n+-------+---------------------------------------------------------------------------+---------------------------------------+------+----------+\nonly showing top 25 rows\n\nTook 18.583 seconds\nTop 25 Science Fiction with highest rating:\n+-------+--------------------------------------------------------------------+--------------------------------------------------+------+----------+\n|movieId|title                                                               |genres                                            |userId|prediction|\n+-------+--------------------------------------------------------------------+--------------------------------------------------+------+----------+\n|94466  |Black Mirror (2011)                                                 |Drama|Sci-Fi                                      |1000  |4.1427    |\n|108979 |Cowboy Bebop (1998)                                                 |Action|Adventure|Animation|Crime|Sci-Fi           |1000  |4.0531583 |\n|60904  |Heart of a Dog (Sobachye serdtse) (1988)                            |Comedy|Drama|Sci-Fi                               |1000  |4.0251846 |\n|1196   |Star Wars: Episode V - The Empire Strikes Back (1980)               |Action|Adventure|Sci-Fi                           |1000  |4.0028653 |\n|2571   |Matrix, The (1999)                                                  |Action|Sci-Fi|Thriller                            |1000  |4.001184  |\n|260    |Star Wars: Episode IV - A New Hope (1977)                           |Action|Adventure|Sci-Fi                           |1000  |3.9867935 |\n|7099   |Nausicaä of the Valley of the Wind (Kaze no tani no Naushika) (1984)|Adventure|Animation|Drama|Fantasy|Sci-Fi          |1000  |3.9752226 |\n|541    |Blade Runner (1982)                                                 |Action|Sci-Fi|Thriller                            |1000  |3.9750931 |\n|79132  |Inception (2010)                                                    |Action|Crime|Drama|Mystery|Sci-Fi|Thriller|IMAX   |1000  |3.9675436 |\n|135456 |Ghost in the Shell: Stand Alone Complex - The Laughing Man (2005)   |Action|Animation|Crime|Sci-Fi                     |1000  |3.9546967 |\n|136449 |Ghost in the Shell 2.0 (2008)                                       |Action|Animation|Sci-Fi                           |1000  |3.951998  |\n|6350   |Laputa: Castle in the Sky (Tenkû no shiro Rapyuta) (1986)           |Action|Adventure|Animation|Children|Fantasy|Sci-Fi|1000  |3.9491477 |\n|42351  |Threads (1984)                                                      |Drama|Sci-Fi|War                                  |1000  |3.9380019 |\n|48780  |Prestige, The (2006)                                                |Drama|Mystery|Sci-Fi|Thriller                     |1000  |3.9210987 |\n|1214   |Alien (1979)                                                        |Horror|Sci-Fi                                     |1000  |3.911226  |\n|1223   |Grand Day Out with Wallace and Gromit, A (1989)                     |Adventure|Animation|Children|Comedy|Sci-Fi        |1000  |3.9108155 |\n|147384 |Doctor Who: The Runaway Bride (2007)                                |Sci-Fi                                            |1000  |3.906238  |\n|99764  |It&apos;s Such a Beautiful Day (2012)                                    |Animation|Comedy|Drama|Fantasy|Sci-Fi             |1000  |3.901717  |\n|68237  |Moon (2009)                                                         |Drama|Mystery|Sci-Fi|Thriller                     |1000  |3.900674  |\n|36363  |Kin-Dza-Dza! (1986)                                                 |Comedy|Drama|Sci-Fi                               |1000  |3.8966923 |\n|27611  |Battlestar Galactica (2003)                                         |Drama|Sci-Fi|War                                  |1000  |3.889611  |\n|40697  |Babylon 5                                                           |Sci-Fi                                            |1000  |3.8887784 |\n|109487 |Interstellar (2014)                                                 |Sci-Fi|IMAX                                       |1000  |3.8803124 |\n|91233  |Lifted (2006)                                                       |Animation|Comedy|Sci-Fi                           |1000  |3.873668  |\n|4454   |More (1998)                                                         |Animation|Drama|Sci-Fi|IMAX                       |1000  |3.8732738 |\n+-------+--------------------------------------------------------------------+--------------------------------------------------+------+----------+\nonly showing top 25 rows\n\nTook 18.486 seconds\nTop 25 Animation with highest rating:\n+-------+---------------------------------------------------------------------+--------------------------------------------------+------+----------+\n|movieId|title                                                                |genres                                            |userId|prediction|\n+-------+---------------------------------------------------------------------+--------------------------------------------------+------+----------+\n|160718 |Piper (2016)                                                         |Animation                                         |1000  |4.1754093 |\n|134849 |Duck Amuck (1953)                                                    |Animation|Children|Comedy                         |1000  |4.116488  |\n|5618   |Spirited Away (Sen to Chihiro no kamikakushi) (2001)                 |Adventure|Animation|Fantasy                       |1000  |4.072469  |\n|108979 |Cowboy Bebop (1998)                                                  |Action|Adventure|Animation|Crime|Sci-Fi           |1000  |4.0531583 |\n|5971   |My Neighbor Totoro (Tonari no Totoro) (1988)                         |Animation|Children|Drama|Fantasy                  |1000  |4.032962  |\n|1148   |Wallace &amp; Gromit: The Wrong Trousers (1993)                          |Animation|Children|Comedy|Crime                   |1000  |4.0250235 |\n|148881 |World of Tomorrow (2015)                                             |Animation|Comedy                                  |1000  |4.024053  |\n|162578 |Kubo and the Two Strings (2016)                                      |Adventure|Animation|Children|Fantasy              |1000  |4.0170193 |\n|745    |Wallace &amp; Gromit: A Close Shave (1995)                               |Animation|Children|Comedy                         |1000  |4.000136  |\n|5690   |Grave of the Fireflies (Hotaru no haka) (1988)                       |Animation|Drama|War                               |1000  |3.9950335 |\n|32657  |Man Who Planted Trees, The (Homme qui plantait des arbres, L&apos;) (1987)|Animation|Drama                                   |1000  |3.9944205 |\n|3000   |Princess Mononoke (Mononoke-hime) (1997)                             |Action|Adventure|Animation|Drama|Fantasy          |1000  |3.9872952 |\n|3429   |Creature Comforts (1989)                                             |Animation|Comedy                                  |1000  |3.9834394 |\n|7099   |Nausicaä of the Valley of the Wind (Kaze no tani no Naushika) (1984) |Adventure|Animation|Drama|Fantasy|Sci-Fi          |1000  |3.9752226 |\n|98491  |Paperman (2012)                                                      |Animation|Comedy|Romance                          |1000  |3.9635983 |\n|31658  |Howl&apos;s Moving Castle (Hauru no ugoku shiro) (2004)                   |Adventure|Animation|Fantasy|Romance               |1000  |3.9625523 |\n|101962 |Wolf Children (Okami kodomo no ame to yuki) (2012)                   |Animation|Fantasy                                 |1000  |3.9620924 |\n|135456 |Ghost in the Shell: Stand Alone Complex - The Laughing Man (2005)    |Action|Animation|Crime|Sci-Fi                     |1000  |3.9546967 |\n|136449 |Ghost in the Shell 2.0 (2008)                                        |Action|Animation|Sci-Fi                           |1000  |3.951998  |\n|6350   |Laputa: Castle in the Sky (Tenkû no shiro Rapyuta) (1986)            |Action|Adventure|Animation|Children|Fantasy|Sci-Fi|1000  |3.9491477 |\n|720    |Wallace &amp; Gromit: The Best of Aardman Animation (1996)               |Adventure|Animation|Comedy                        |1000  |3.940963  |\n|95311  |Presto (2008)                                                        |Animation|Children|Comedy|Fantasy                 |1000  |3.9322855 |\n|26903  |Whisper of the Heart (Mimi wo sumaseba) (1995)                       |Animation|Drama|Romance                           |1000  |3.930319  |\n|114554 |Tale of Princess Kaguya, The (Kaguyahime no monogatari) (2013)       |Animation|Drama|Fantasy                           |1000  |3.9245875 |\n|95654  |Geri&apos;s Game (1997)                                                   |Animation|Children                                |1000  |3.9234214 |\n+-------+---------------------------------------------------------------------+--------------------------------------------------+------+----------+\nonly showing top 25 rows\n\nTook 18.592 seconds\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;false&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-79-a9fa3a387ded&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansigreen\">print</span> <span class=\"ansiblue\">&quot;Top 25 predicted movie with highest rating:&quot;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 2</span><span class=\"ansiyellow\"> </span>top25Movies <span class=\"ansiyellow\">=</span> predictedMovies<span class=\"ansiyellow\">.</span>orderBy<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;prediction&apos;</span><span class=\"ansiyellow\">,</span> ascending <span class=\"ansiyellow\">=</span> False<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">25</span><span class=\"ansiyellow\">,</span> false<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> <span class=\"ansigreen\">print</span> <span class=\"ansiblue\">&quot;Top 25 commedy with highest rating:&quot;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span> top25Comedy <span class=\"ansiyellow\">=</span> predictedMovies<span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span>predictedMovies<span class=\"ansiyellow\">.</span>genres<span class=\"ansiyellow\">.</span>like<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;%Comedy%&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>orderBy<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;prediction&apos;</span><span class=\"ansiyellow\">,</span> ascending <span class=\"ansiyellow\">=</span> False<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>show<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">25</span><span class=\"ansiyellow\">,</span> false<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;false&apos; is not defined</div>","workflows":[],"startTime":1495255726869,"submitTime":1495254603066,"finishTime":1495255802405,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"52cfc86e-33fa-4ae0-8903-e93ddd03b503"},{"version":"CommandV1","origId":3132269910568307,"guid":"42ac8d2a-1307-4e4d-a3bb-87785c105cfe","subtype":"command","commandType":"auto","position":7.996826171875,"command":"%md\n### Persisting the model\n\nAfter we have trained the model, we may want to store it somewhere for later use, such as saving time when starting up the server. We can save it easily to AWS S3 by specifying the bucket name, access key, secrete key and the file path. \n\nThe following are examples for saving and loading the trained ALS model:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1495254603078,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"96aa30b1-6991-41a1-8329-807efb38ef7a"},{"version":"CommandV1","origId":1584724551463081,"guid":"ff89b608-744a-40ba-8a53-11747c5819bc","subtype":"command","commandType":"auto","position":8.0,"command":"timeBegin = time()\n\n# Save the trained model to S3\nmodel.write().overwrite().save(\"s3a://%s:%s@%s/%s\" % (ACCESS_KEY, ENCODED_SECRET_KEY, AWS_BUCKET_NAME, \"model\"))\n\ntimeElapsed = time() - timeBegin\nprint \"Save model took %s seconds\" % round(timeElapsed, 3)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Save model took 27.707 seconds\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"java.io.IOException: Path s3a://AKIAJGPDUDA6BE5XTI4A:aWfIqh%2FH41AgTuaQ0s1Nvug79I+3nOtEn7XAa4nk@comp4651-movie-data/model already exists. Please use write.overwrite().save(path) to overwrite it.","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">Py4JJavaError</span>                             Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;ipython-input-44-a4108cfcf916&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansired\"># Save the trained model to S3</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 4</span><span class=\"ansiyellow\"> </span>model<span class=\"ansiyellow\">.</span>save<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;s3a://%s:%s@%s/%s&quot;</span> <span class=\"ansiyellow\">%</span> <span class=\"ansiyellow\">(</span>ACCESS_KEY<span class=\"ansiyellow\">,</span> ENCODED_SECRET_KEY<span class=\"ansiyellow\">,</span> AWS_BUCKET_NAME<span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&quot;model&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      6</span> timeElapsed <span class=\"ansiyellow\">=</span> time<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span> <span class=\"ansiyellow\">-</span> timeBegin<span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/ml/util.py</span> in <span class=\"ansicyan\">save</span><span class=\"ansiblue\">(self, path)</span>\n<span class=\"ansigreen\">    140</span>     <span class=\"ansigreen\">def</span> save<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">,</span> path<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    141</span>         <span class=\"ansiblue\">&quot;&quot;&quot;Save this ML instance to the given path, a shortcut of &#96;write().save(path)&#96;.&quot;&quot;&quot;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 142</span><span class=\"ansiyellow\">         </span>self<span class=\"ansiyellow\">.</span>write<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>save<span class=\"ansiyellow\">(</span>path<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    143</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    144</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/ml/util.py</span> in <span class=\"ansicyan\">save</span><span class=\"ansiblue\">(self, path)</span>\n<span class=\"ansigreen\">    104</span>         <span class=\"ansigreen\">if</span> <span class=\"ansigreen\">not</span> isinstance<span class=\"ansiyellow\">(</span>path<span class=\"ansiyellow\">,</span> basestring<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    105</span>             <span class=\"ansigreen\">raise</span> TypeError<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;path should be a basestring, got type %s&quot;</span> <span class=\"ansiyellow\">%</span> type<span class=\"ansiyellow\">(</span>path<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 106</span><span class=\"ansiyellow\">         </span>self<span class=\"ansiyellow\">.</span>_jwrite<span class=\"ansiyellow\">.</span>save<span class=\"ansiyellow\">(</span>path<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    107</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    108</span>     <span class=\"ansigreen\">def</span> overwrite<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1131</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1132</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1133</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1134</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1135</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     61</span>     <span class=\"ansigreen\">def</span> deco<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>a<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">**</span>kw<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     62</span>         <span class=\"ansigreen\">try</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 63</span><span class=\"ansiyellow\">             </span><span class=\"ansigreen\">return</span> f<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>a<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">**</span>kw<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     64</span>         <span class=\"ansigreen\">except</span> py4j<span class=\"ansiyellow\">.</span>protocol<span class=\"ansiyellow\">.</span>Py4JJavaError <span class=\"ansigreen\">as</span> e<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     65</span>             s <span class=\"ansiyellow\">=</span> e<span class=\"ansiyellow\">.</span>java_exception<span class=\"ansiyellow\">.</span>toString<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.4-src.zip/py4j/protocol.py</span> in <span class=\"ansicyan\">get_return_value</span><span class=\"ansiblue\">(answer, gateway_client, target_id, name)</span>\n<span class=\"ansigreen\">    317</span>                 raise Py4JJavaError(\n<span class=\"ansigreen\">    318</span>                     <span class=\"ansiblue\">&quot;An error occurred while calling {0}{1}{2}.\\n&quot;</span><span class=\"ansiyellow\">.</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 319</span><span class=\"ansiyellow\">                     format(target_id, &quot;.&quot;, name), value)\n</span><span class=\"ansigreen\">    320</span>             <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    321</span>                 raise Py4JError(\n\n<span class=\"ansired\">Py4JJavaError</span>: An error occurred while calling o63919.save.\n: java.io.IOException: Path s3a://AKIAJGPDUDA6BE5XTI4A:aWfIqh%2FH41AgTuaQ0s1Nvug79I+3nOtEn7XAa4nk@comp4651-movie-data/model already exists. Please use write.overwrite().save(path) to overwrite it.\n\tat org.apache.spark.ml.util.MLWriter.save(ReadWrite.scala:107)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\n\tat py4j.Gateway.invoke(Gateway.java:280)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:214)\n\tat java.lang.Thread.run(Thread.java:745)\n</div>","workflows":[],"startTime":1495258230825,"submitTime":1495258230820,"finishTime":1495258258633,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d17e4d1c-1366-439a-9f60-8850d173968a"},{"version":"CommandV1","origId":822182306953818,"guid":"58cfac42-67a3-43f8-b641-2e70fb6c9da4","subtype":"command","commandType":"auto","position":9.0,"command":"from pyspark.ml.recommendation import ALSModel\n\ntimeBegin = time()\n\n# Load model previous saved model\nmodel = ALSModel.load(\"s3a://%s:%s@%s/%s\" % (ACCESS_KEY, ENCODED_SECRET_KEY, AWS_BUCKET_NAME, \"model\"))\n\ntimeElapsed = time() - timeBegin\nprint \"Load model took %s seconds\" % round(timeElapsed, 3)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Load model took 8.874 seconds\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[]},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1495258396762,"submitTime":1495258396758,"finishTime":1495258405698,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cc6fb2a7-8e83-40ee-8cca-fdf4da2e434d"}],"dashboards":[{"version":"DashboardViewV1","origId":2257638575419510,"guid":"225f40e5-9ee3-4a39-aa86-1c3b6a524d9a","nuid":"0ff4ce1b-d84d-4fc3-9fdf-c1d8c535c813","title":"Untitled","width":1024,"layoutOption":{"stack":true,"grid":true},"elements":[],"globalVars":{}}],"guid":"f00d7556-6bf0-40db-8147-3be0112e02bc","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}};</script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/js/notebook-main.js"
 onerror="window.mainJsLoadError = true;"></script>
</head>
<body>
  <script>
if (window.mainJsLoadError) {
  var u = 'https://databricks-prod-cloudfront.cloud.databricks.com/static/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855/js/notebook-main.js';
  var b = document.getElementsByTagName('body')[0];
  var c = document.createElement('div');
  c.innerHTML = ('<h1>Network Error</h1>' +
    '<p><b>Please check your network connection and try again.</b></p>' +
    '<p>Could not load a required resource: ' + u + '</p>');
  c.style.margin = '30px';
  c.style.padding = '20px 50px';
  c.style.backgroundColor = '#f5f5f5';
  c.style.borderRadius = '5px';
  b.appendChild(c);
}
</script>
</body>
</html>
